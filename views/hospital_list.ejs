<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

<!--
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
-->
    <% include ./partials/head %>
    <link rel="stylesheet" href="/stylesheets/card_style.css">
    <link rel="stylesheet" href="/stylesheets/hospital-list_style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/css/bootstrap-select.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/js/bootstrap-select.min.js"></script>

        <!--RATING 관련..-->
        <link href="/kartik-v-bootstrap-star-rating-19120d9/css/star-rating.css" media="all" rel="stylesheet" type="text/css" />
    
        <!-- optionally if you need to use a theme, then include the theme CSS file as mentioned below -->
        <link href="/kartik-v-bootstrap-star-rating-19120d9/themes/krajee-svg/theme.css" media="all" rel="stylesheet" type="text/css" />
    
        <!-- important mandatory libraries -->
        <script src="/kartik-v-bootstrap-star-rating-19120d9/js/star-rating.js" type="text/javascript"></script>
    
        <!-- optionally if you need to use a theme, then include the theme JS file as mentioned below -->
        <script src="/kartik-v-bootstrap-star-rating-19120d9/themes/krajee-svg/theme.js"></script>
    
        <!-- optionally if you need translation for your language then include locale file as mentioned below -->
        <script src="/kartik-v-bootstrap-star-rating-19120d9/js/locales/ko.js"></script> 
    

    <script src="./javascripts/util.js"></script>
    <script>
      $( document ).ready( function() {
        var jbOffset = $( '.jbMenu' ).offset();
        $( window ).scroll( function() {
          if ( $( document ).scrollTop() > jbOffset.top ) {
            $( '.jbMenu' ).addClass( 'jbFixed' );
          }
          else {
            $( '.jbMenu' ).removeClass( 'jbFixed' );
          }
        });
      } );
      
      $('.selectpicker').selectpicker({
        style: 'btn-success',
    });
    </script>

  </head>
    <script>
        function getSearchURL()
        {
            return "/hospital/1";
        }
    </script>
  <body>
    <% include ./partials/top %>

    <div class="jbMenu">
        <div class="container">
            <div class="row">
                <div class="col-md-4" id="hide_item" >
                        <font color="white" >
                            <h4  align='left' >Showing <strong><%=data.results.length%></strong> of <%=data.pagination.numRows%> results</h4>
                        </font>
                </div>

                <div class="col-md-3" id="hide_item" >
                    <select name="subject"  class="selectpicker" data-size="10">
                        <option value="-1">전체</option>
                        <% subject.forEach(function(item,index){ %>
                            <option value="<%= item.code %>"><%=item.subject %></option>
                        <%});%>
                    </select>
                </div>

                <div class="col-md-4">
                    <form action="/hospital">
                    <div class="input-group form-group">
                        <input type="text"  class="form-control" placeholder="Ex. Specialist, Name, Doctor..." name="search_text" value="<%=req.query.search_text%>" >
                        <span class="input-group-btn">
                            <input type="submit" class="btn btn-primary" value="Search">
                        </span>
                    </div>        
                        <input type="hidden" name="sido" value="<%=req.query.sido%>"/>
                        <input type="hidden" name="gungu" value="<%=req.query.gungu%>"/>
                        <input type="hidden" name="page" value="<%=req.query.page%>"/>
                    </form>    
                </div>
            </div>
        </div>
    </div>
            
    <div class="container">
        <ul class="breadcrumb" style="margin-top:10px">
            <li><a href="/hospital">전국</a></li>
            <%if(breadCrumbs.sidoName){%>
                <li><a href="#"><%=breadCrumbs.sidoName%></a></li>
            <%}%>
            <%if(breadCrumbs.gunguName){%>
                <li><a href="#"><%=breadCrumbs.gunguName%></a></li>
            <%}%>
        </ul>
        <div style="overflow:hidden" >
            <% sido.forEach(function(item, index) { %>
                <div style="width:25%;float:left;background">
                    <a href="#" onclick="appendUrlParameter('sido','<%=item.sidoCode%>')"><%=item.sidoName%></a>
                </div>
            <% }) %>
            
            <% gungu.forEach(function(item, index) { %>
                <div style="width:25%;float:left;background">
                    <a href="#" onclick="appendUrlParameter('sido','<%=item.sidoCode%>',false);appendUrlParameter('gungu','<%=item.gunguCode%>')"><%=item.gunguName%></a>
                </div>
            <% }) %>
        </div>
        <br>
            
        <hr>

        <div class="col-md-12" style="margin-bottom:20px">
            <div class="comments-list" style="width:100%;" >
                    <!--{% for hospital in hospital_list %}-->
                    <% data.results.forEach(function(item,index){%>
                        <div class="col-md-6" >
                            <div class="card" >
                                <div class="card-header">
                                    <a href="#"><h3><%=item.name%></h3></a>
                                </div>
                                <div class="card-body">
                                        <div class="card-text">
                                            <ul>
                                                <li>전화번호 - <%=item.tel%></li>
                                                <li>주소 - <%=item.addr%></li>
                                                <li>진료과목 - <%=item.subjects%></li>
                                            </ul>
                                        </div>
                                        <hr color="#ccc"/>
                                                                            
                                        <%if(item.score){%>
                                            <input id="input-id" type="text" class="rating" readOnly=true value=<%=item.score%> data-size="xs" lang="ko" >
                                        <%} else {%>
                                            <input id="input-id" type="text" class="rating" readOnly=true value=0 data-size="xs" lang="ko" >
                                        <%}%>
                                        
                                    <a href="/hospital/reserve/<%=item.id%>" class="btn btn-primary pull-right">예약</a>
                                </div>
                            </div>
                        </div>
                    <%});%>
            </div>
        </div>

        <hr>
        
        <div>
            <ul class="pagination">
                    <%if(data.pagination.current==1){%>
                        <li class="page-item disabled"><a class="page-link">처음</a></li>
                    <%} else {%>
                        <li class="page-item"><a onclick="appendUrlParameter('page','0')">처음</a></li>
                    <%}%>
                    <% var i=(Number(data.pagination.current)>5? Number(data.pagination.current) - 4 : 1)%>
                    <% if(i !== 1){%>
                        <li class="page-item disabled"><a>...</a></li>
                    <%}%>
                    <% for(;i<=(Number(data.pagination.current) +4) && i<=data.pagination.numPages;i++){%>
                        <% if(i!=data.pagination.current){ %>
                            <li class="page-item"><a class="page-link" onclick="appendUrlParameter('page',<%=i%>)"> <%=i%></a></li>
                        <%} else { %>
                            <li class="page-item active"><a class="page-link" onclick="appendUrlParameter('page',<%=i%>)"> <%=i%></a></li>
                        <% } %>
                        <% if(i==Number(data.pagination.current) + 4 && i < data.pagination.numPages) {%>
                            <li class="disabled"><a>...</a></li>
                        <%}%>
                    <%}%>
                    <%if(data.pagination.current==data.pagination.numPages){%>
                        <li class="page-item disabled"><a class="page-link">마지막</a></li>
                    <%} else {%>
                        <li class="page-item"><a class="page-link" onclick="appendUrlParameter('page','<%=data.pagination.numPages%>')">마지막</a></li>
                    <%}%>
            </ul>
        </div>

    
    </div>

    <% include ./partials/footer %>
  </body>
  <script>        
        function appendUrlParameter(key,value,isSubmit=true)
        {
            if(key!="page")
            {
                $('input[name=page]').val(0);    
            }
            $('input[name=' + key + ']').val(value);
            if(isSubmit)
            {
                $('form').submit();
            }   
            //var append_Url = updateUrlParameter(url,key,value);
            //console.log(append_Url);
            //location.href=append_Url;
        }
        
  </script>
</html>
